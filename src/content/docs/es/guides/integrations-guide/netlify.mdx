---
type: integration
title: '@astrojs/netlify'
description: Aprende cómo usar el adaptador @astrojs/netlify para desplegar tu proyecto de Astro.
sidebar:
  label: Netlify
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/netlify/'
category: adapter
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import Since from '~/components/Since.astro';

Este adaptador permite a Astro desplegar tus [rutas y características renderizadas bajo demanda](/es/guides/on-demand-rendering/) a [Netlify](https://www.netlify.com/), incluyendo [islas de servidor](/es/guides/server-islands/), [acciones](/es/guides/actions/), y [sesiones](/es/guides/sessions/).

Si estás usando Astro como un generador de sitios estáticos, solo necesitas este adaptador si estás usando servicios adicionales de Netlify que requieren un servidor (por ejemplo, [Netlify Image CDN](#soporte-para-netlify-image-cdn)). De lo contrario, no necesitas un adaptador para desplegar tu sitio estático.

Aprende cómo desplegar tu sitio de Astro en nuestra [guía de despliegue en Netlify](/es/guides/deploy/netlify/).

## Por qué Astro Netlify

[Netlify](https://www.netlify.com/) es una plataforma de despliegue que te permite alojar tu sitio conectándose directamente a tu repositorio de GitHub. Este adaptador mejora el proceso de compilación de Astro para preparar tu proyecto para el despliegue a través de Netlify.

## Instalación

Astro incluye un comando `astro add` para automatizar la configuración de integraciones oficiales. Si prefieres, puedes [instalar integraciones manualmente](#instalación-manual) en su lugar.

Agrega el adaptador de Netlify para habilitar el renderizado bajo demanda en tu proyecto de Astro con el comando `astro add`. 
Esto instalará `@astrojs/netlify` y hará los cambios apropiados a tu archivo `astro.config.mjs` en un solo paso.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add netlify
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add netlify
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add netlify
  ```
  </Fragment>
</PackageManagerTabs>

Ahora, puedes habilitar [renderizado bajo demanda por página](/es/guides/on-demand-rendering/#habilitar-el-renderizado-bajo-demanda), o configurar tu configuración de salida de compilación a `output: 'server'` para [renderizar en servidor todas tus páginas por defecto](/es/guides/on-demand-rendering/#modo-server).

### Instalación Manual

Primero, instala el adaptador de Netlify a las dependencias de tu proyecto usando tu gestor de paquetes preferido:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/netlify
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/netlify
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/netlify
  ```
  </Fragment>
</PackageManagerTabs>

Luego, agrega el adaptador a tu archivo `astro.config.*`:

   ```js title="astro.config.mjs" ins={2, 6}
    import { defineConfig } from 'astro/config';
    import netlify from '@astrojs/netlify';

    export default defineConfig({
       // ...
       adapter: netlify(),
    });
   ```

## Uso

[Lee la guía completa de despliegue aquí.](/es/guides/deploy/netlify/)

Sigue las instrucciones para [construir tu sitio localmente](/es/guides/deploy/#construyendo-tu-proyecto-localmente). Después de construir, tendrás una carpeta `.netlify/` que contiene tanto [Netlify Functions](https://docs.netlify.com/functions/overview/) en la carpeta `.netlify/functions-internal/` como [Netlify Edge Functions](https://docs.netlify.com/edge-functions/overview/) en la carpeta `.netlify/edge-functions/`.

Para desplegar tu sitio, instala el [Netlify CLI](https://docs.netlify.com/cli/get-started/) y ejecuta:

```sh
netlify deploy
```

La [entrada del blog de Netlify sobre Astro](https://www.netlify.com/blog/how-to-deploy-astro/) y la [documentación de Netlify](https://docs.netlify.com/integrations/frameworks/astro/) proporcionan más información sobre cómo usar esta integración para desplegar en Netlify.

### Ejecutando middleware de Astro en Netlify Edge Functions

Cualquier middleware de Astro se aplica a páginas pre-renderizadas en tiempo de compilación, y a páginas renderizadas bajo demanda en tiempo de ejecución.

Para implementar redirecciones, control de acceso o encabezados de respuesta personalizados para páginas pre-renderizadas, ejecuta tu middleware en Netlify Edge Functions habilitando la opción [`edgeMiddleware`](/es/reference/adapter-reference/#edgemiddleware):

```js title="astro.config.mjs" ins={7}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  // ...
  adapter: netlify({
    edgeMiddleware: true,
  }),
});
```

Cuando `edgeMiddleware` está habilitado, una función edge ejecutará tu código de middleware para todas las solicitudes incluyendo activos estáticos, páginas pre-renderizadas y páginas renderizadas bajo demanda.

Para páginas renderizadas bajo demanda, el objeto `context.locals` se serializa usando JSON y se envía en un encabezado para la función serverless, que realiza el renderizado. Como medida de seguridad, la función serverless se negará a servir solicitudes con una respuesta `403 Forbidden` a menos que provengan de la función edge generada.

### Accediendo al contexto edge desde tu sitio

Netlify Edge Functions proporcionan un [objeto de contexto](https://docs.netlify.com/edge-functions/api/#netlify-specific-context-object) que incluye metadatos sobre la solicitud, como la IP de un usuario, datos de geolocalización y cookies.

Esto se puede acceder a través del objeto `Astro.locals.netlify.context`:

```astro
---
const {
  geo: { city },
} = Astro.locals.netlify.context;
---

<h1>Hola, amable visitante de {city}!</h1>
```

Si estás usando TypeScript, puedes obtener las definiciones de tipo adecuadas actualizando `src/env.d.ts` para usar `NetlifyLocals`:

```ts title="src/env.d.ts"
type NetlifyLocals = import('@astrojs/netlify').NetlifyLocals

declare namespace App {
  interface Locals extends NetlifyLocals {
    // ...
  }
}
```

Esto no está disponible en páginas prerenderizadas.

### Soporte para Netlify Image CDN

Este adaptador por defecto usa el [Netlify Image CDN](https://docs.netlify.com/image-cdn/overview/) para transformar imágenes sobre la marcha sin impactar los tiempos de compilación.
Está implementado usando un [Servicio de Imagen de Astro](/es/reference/image-service-reference/) por debajo.

Para optar por no usar la optimización de imágenes remotas del Netlify Image CDN, usa la opción `imageCDN`:

```js title="astro.config.mjs" ins={7}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  // ...
  adapter: netlify({
    imageCDN: false,
  }),
});
```

Si estás usando imágenes alojadas en otro dominio, debes autorizar el dominio o patrones de URL usando las opciones de configuración [`image.domains`](/es/reference/configuration-reference/#imagedomains) o [`image.remotePatterns`](/es/reference/configuration-reference/#imageremotepatterns):

```js title="astro.config.mjs" ins={7-9}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
    // ...
    adapter: netlify(),
    image: {
      domains: ['example.com'],
    },
});
```
Para más información, ve [la guía para autorizar imágenes remotas](/es/guides/images/#autorizando-imágenes-remotas). Esto no es requerido para imágenes alojadas en el mismo dominio que tu sitio.

### Sitios estáticos con el Adaptador de Netlify

Para sitios estáticos (`output: 'static'`) alojados en Netlify, usualmente no necesitas un adaptador. Sin embargo, algunas características de despliegue solo están disponibles a través de un adaptador.

Los sitios estáticos necesitarán instalar este adaptador para usar y configurar el [servicio de imagen](#soporte-para-netlify-image-cdn) de Netlify.

Si usas la configuración `redirects` en tu configuración de Astro, el adaptador de Netlify puede ser usado para traducir esto al formato `_redirects` apropiado.

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  // ...
  adapter: netlify(),
  redirects: {
    '/blog/old-post': '/blog/new-post',
  },
});
```

Una vez que ejecutes `astro build` habrá un archivo `dist/_redirects`. Netlify usará eso para enrutar correctamente las páginas en producción.

:::note
Aún puedes incluir un archivo `public/_redirects` para redirecciones manuales. Cualquier redirección que especifiques en la configuración de redirects se agrega al final de las tuyas propias.
:::

### Sesiones

La [API de Sesiones](/es/guides/sessions/) de Astro te permite almacenar fácilmente datos de usuario entre solicitudes. Esto puede ser usado para cosas como datos de usuario y preferencias, carritos de compras, y credenciales de autenticación. A diferencia del almacenamiento de cookies, no hay límites de tamaño en los datos, y puede ser restaurado en diferentes dispositivos.

Astro automáticamente configura [Netlify Blobs](https://docs.netlify.com/blobs/overview/) para almacenamiento de sesiones cuando usa el adaptador de Netlify. Si prefieres usar un controlador de almacenamiento de sesiones diferente, puedes especificarlo en tu configuración de Astro. Ve [la referencia de configuración de `session`](/es/reference/configuration-reference/#sessiondriver) para más detalles.

### Almacenamiento en caché de páginas

Las páginas renderizadas bajo demanda sin ningún contenido dinámico pueden ser almacenadas en caché para mejorar el rendimiento y reducir el uso de recursos.
Habilitar la opción `cacheOnDemandPages` en el adaptador almacenará en caché todas las páginas renderizadas en servidor por hasta un año:

```ts title="astro.config.mjs" ins={4}
export default defineConfig({
  // ...
  adapter: netlify({
    cacheOnDemandPages: true,
  }),
});
```

Esto puede ser cambiado por página agregando encabezados de caché a tu respuesta:

```astro title="pages/index.astro"
---
import Layout from '../components/Layout.astro';

Astro.response.headers.set('CDN-Cache-Control', 'public, max-age=45, must-revalidate');
---

<Layout title="Astro en Netlify">
  {new Date()}
</Layout>
```

Con [control de caché de grano fino](https://www.netlify.com/blog/swr-and-fine-grained-cache-control/), Netlify soporta encabezados de caché estándar como `CDN-Cache-Control` o `Vary`.
Consulta la documentación para aprender sobre la implementación de, por ejemplo, tiempo de vida (TTL) o caché stale while revalidate (SWR): https://docs.netlify.com/platform/caching

### Incluyendo o excluyendo archivos de Netlify Functions

Cuando despliegas un sitio de Astro con renderizado bajo demanda a Netlify, las funciones generadas automáticamente rastrean e incluyen dependencias del servidor. Sin embargo, es posible que necesites personalizar qué archivos se incluyen en tus Netlify Functions.

#### `includeFiles`

<p>
**Tipo:**  `string[]`<br />
**Por defecto:** `[]`<br />
<Since v="5.3.0" />
</p>

La propiedad `includeFiles` te permite especificar explícitamente archivos adicionales que deberían ser empaquetados con tu función. Esto es útil para archivos que no son detectados automáticamente como dependencias, tales como:
- Archivos de datos cargados usando operaciones `fs`
- Archivos de configuración
- Archivos de plantilla

Proporciona un array de archivos adicionales para incluir con rutas de archivos relativas al [`root`](/es/reference/configuration-reference/#root) de tu proyecto. Las rutas absolutas pueden no funcionar como se esperaba.

```js title="astro.config.mjs" ins={7}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  // ...
  adapter: netlify({
    includeFiles: ['./my-data.json'], // relativo a `root`
  }),
});
```

#### `excludeFiles`

<p>
**Tipo:**  `string[]`<br />
**Por defecto:** `[]`<br />
<Since v="5.3.0" />
</p>

Puedes usar la propiedad `excludeFiles` para prevenir que archivos específicos sean empaquetados que de otra manera serían incluidos. Esto es útil para:
- Reducir el tamaño del bundle
- Excluir binarios grandes
- Prevenir que archivos no deseados sean desplegados

Proporciona un array de archivos específicos para excluir con rutas de archivos relativas al [`root`](/es/reference/configuration-reference/#root) de tu proyecto. Las rutas absolutas pueden no funcionar como se esperaba.

```js title="astro.config.mjs" ins={7}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  // ...
  adapter: netlify({
    excludeFiles: ['./src/some_big_file.jpg'], // relativo a `root`
  }),
});
```

#### Usando patrones glob

Tanto `includeFiles` como `excludeFiles` soportan [patrones glob](/es/guides/imports/#patrones-glob) para coincidir con múltiples archivos:

```js title="astro.config.mjs" ins={7, 10-11}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  adapter: netlify({
    includeFiles: [
      './data/**/*.json'
    ],
    excludeFiles: [
      './node_modules/package/**/*',
      './src/**/*.test.js'
    ]
  }),
});
```

## Características experimentales

Las siguientes características también están disponibles para usar, pero pueden estar sujetas a cambios breaking en futuras actualizaciones. Por favor sigue el [`@astrojs/netlify` CHANGELOG](https://github.com/withastro/astro/tree/main/packages/integrations/netlify/CHANGELOG.md) cuidadosamente para actualizaciones si estás usando estas características en tu proyecto.

### `experimentalStaticHeaders`

<p>
  **Tipo:** `boolean` <br />
  **Por defecto:** `false`<br />
  <Since v="6.4.0"  pkg="@astrojs/netlify"/>
</p>

Habilita especificar encabezados personalizados para páginas pre-renderizadas en la configuración de Netlify.

Si está habilitado, el adaptador guardará [encabezados estáticos en el archivo de configuración de la Framework API](https://docs.netlify.com/frameworks-api/#headers) cuando sean proporcionados por características de Astro, como Content Security Policy.

Por ejemplo, cuando [experimental Content Security Policy](/es/reference/experimental-flags/csp/) está habilitado, `experimentalStaticHeaders` puede ser usado para agregar los `headers` CSP a tu configuración de Netlify, en lugar de crear un elemento `<meta>`:

```js title="astro.config.mjs" {9}
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';

export default defineConfig({
  experimental: {
    csp: true
  },
  adapter: netlify({
    experimentalStaticHeaders: true 
  })
});
```


## Ejemplos

* El [Astro Netlify Edge Starter](https://github.com/sarahetter/astro-netlify-edge-starter) proporciona un ejemplo y una guía en el README.

* [Navega proyectos de Astro Netlify en GitHub](https://github.com/search?q=path%3A**%2Fastro.config.mjs+%40astrojs%2Fnetlify\&type=code) para más ejemplos!


[astro-integration]: /es/guides/integrations-guide/
